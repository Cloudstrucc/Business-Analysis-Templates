<div class="container py-4">
  <!-- Welcome Header -->
  <div class="card mb-4" style="background: linear-gradient(135deg, var(--cs-primary) 0%, var(--cs-secondary) 100%);">
    <div class="card-body p-4 text-white">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2 class="mb-2">Welcome, {{invite.client_name}}!</h2>
          <p class="mb-0 opacity-75">
            {{#if invite.client_company}}{{invite.client_company}} | {{/if}}
            Please complete the questionnaire(s) below
          </p>
        </div>
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
          {{#if deadlineFormatted}}
            <div class="d-inline-block bg-white bg-opacity-10 rounded px-3 py-2">
              <small class="d-block opacity-75">Deadline</small>
              <strong>{{deadlineFormatted}}</strong>
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Progress Overview -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="stat-card">
        <div class="stat-icon" style="background: rgba(0,168,232,0.1); color: var(--cs-accent);">
          <i class="bi bi-file-text"></i>
        </div>
        <div class="stat-number">{{totalForms}}</div>
        <div class="stat-label">Total Forms</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
        <div class="stat-icon" style="background: rgba(255,193,7,0.1); color: var(--cs-warning);">
          <i class="bi bi-hourglass-split"></i>
        </div>
        <div class="stat-number">{{inProgressCount}}</div>
        <div class="stat-label">In Progress</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
        <div class="stat-icon" style="background: rgba(40,167,69,0.1); color: var(--cs-success);">
          <i class="bi bi-check-circle"></i>
        </div>
        <div class="stat-number">{{completedCount}}</div>
        <div class="stat-label">Completed</div>
      </div>
    </div>
  </div>
  
  <!-- Forms List -->
  <h4 class="mb-3"><i class="bi bi-list-check me-2"></i>Your Questionnaires</h4>
  
  <div class="row g-4" id="formsList" data-invite-code="{{inviteCode}}">
    {{#each forms}}
      <div class="col-md-6">
        <div class="card h-100 form-card" data-slug="{{this.slug}}" data-status="{{this.status}}" data-progress="{{this.progress}}">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="card-title mb-0">{{this.title}}</h5>
              <span class="badge status-badge"></span>
            </div>
            
            {{#if this.description}}
              <p class="text-muted small mb-3">{{this.description}}</p>
            {{/if}}
            
            <div class="mb-3">
              <div class="d-flex justify-content-between mb-1">
                <small class="text-muted">Progress</small>
                <small class="text-muted progress-text">0%</small>
              </div>
              <div class="progress" style="height: 8px;">
                <div class="progress-bar" style="width: 0%"></div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-transparent">
            <a href="#" class="btn btn-primary w-100 form-link">
              <i class="bi bi-play me-2"></i>Start Questionnaire
            </a>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
  
  <!-- Help Section -->
  <div class="card mt-4 bg-light border-0">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h5><i class="bi bi-question-circle me-2"></i>Need Help?</h5>
          <p class="mb-0 text-muted">
            Your progress is automatically saved as you work. Use your access code 
            <code>{{inviteCode}}</code> to return anytime.
          </p>
        </div>
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
          <a href="mailto:contact-us@cloudstrucc.com" class="btn btn-outline-primary">
            <i class="bi bi-envelope me-2"></i>Contact Support
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const inviteCode = document.getElementById('formsList').dataset.inviteCode;
  console.log('Invite code:', inviteCode);
  
  document.querySelectorAll('.form-card').forEach(function(card) {
    const slug = card.dataset.slug;
    const status = card.dataset.status || '';
    const progress = parseInt(card.dataset.progress) || 0;
    
    console.log('Form:', slug, 'Status:', status, 'Progress:', progress);
    
    // Set status badge
    const badge = card.querySelector('.status-badge');
    if (status === 'submitted') {
      badge.className = 'badge bg-success';
      badge.textContent = 'Completed';
    } else if (status === 'in_progress' || progress > 0) {
      badge.className = 'badge bg-warning';
      badge.textContent = 'In Progress';
    } else {
      badge.className = 'badge bg-secondary';
      badge.textContent = 'Not Started';
    }
    
    // Set progress
    card.querySelector('.progress-text').textContent = progress + '%';
    card.querySelector('.progress-bar').style.width = progress + '%';
    
    // Set link
    const link = card.querySelector('.form-link');
    if (status === 'submitted') {
      link.className = 'btn btn-success w-100 disabled';
      link.innerHTML = '<i class="bi bi-check-circle me-2"></i>Completed';
    } else {
      const formUrl = '/form/' + inviteCode + '/' + slug;
      console.log('Form URL:', formUrl);
      link.href = formUrl;
      if (progress > 0) {
        link.innerHTML = '<i class="bi bi-pencil me-2"></i>Continue';
      } else {
        link.innerHTML = '<i class="bi bi-play me-2"></i>Start Questionnaire';
      }
    }
  });
});
</script>
